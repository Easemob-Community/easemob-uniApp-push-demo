# 小米推送集成指南

## 概述

本指南详细说明如何在 uni-app 项目中集成小米推送服务（MiPush），确保应用能够在小米设备上正常接收推送消息。

## 核心集成步骤

### 1. 小米推送服务配置

#### 1.1 注册小米开发者账号

- 访问[小米开放平台](https://dev.mi.com/console/)
- 注册并登录小米开发者账号
- 创建应用并获取以下关键信息：
  - **AppID**: 小米分配的应用唯一标识
  - **AppKey**: 应用密钥，用于客户端验证
  - **AppSecret**: 主密钥，用于服务端推送验证

#### 1.2 配置应用信息

在小米开放平台中配置以下信息：

- 应用包名：必须与 uni-app 打包时的包名完全一致
- 推送权限：申请 MiPush 推送权限

### 2. 环信后台上传小米推送证书

- 登录环信控制台
- 找到应用，点击应用详情
- 找到即时推送，选择证书管理，点击添加证书
- 上传小米推送证书

### 3. uni-app 项目配置

#### 3.1 原生插件必要配置

- 打开 mainfest.json 文件
- 确保填写 xiaomi_app_id 以及 xiaomi_app_key

### 3. 关键代码集成

#### 3.1 初始化小米推送服务

```javascript
const pushOption = {
  // @ts-ignore
  emPush: EMPushUniPlugin,
  // 配置需要推送的证书名称
  config: {
    MICertificateName: "xxxxxx", // 小米推送证书名称
  },
};
//完整代码见README.md中示例。
```

### 4. 常见问题及解决方案

#### 4.1 Token 获取失败

- **问题**：获取小米推送 Token 失败
- **解决方案**：
  - 检查小米应用配置是否正确
  - 确认设备为小米/Redmi 品牌
  - 验证网络连接是否正常
  - 检查应用签名是否与小米后台配置一致

#### 4.2 推送接收失败

- **问题**：推送消息无法接收
- **解决方案**：
  - 检查应用权限是否授予（通知权限、网络权限）
  - 确认小米推送服务已启用
  - 验证服务端推送参数是否正确
  - 检查设备系统设置中的通知权限

#### 4.3 通知栏不显示

- **问题**：推送到达但不显示通知
- **解决方案**：
  - 检查通知权限设置
  - 确认通知渠道配置正确（Android 8.0+）
  - 验证推送图标配置正确
  - 检查系统通知设置是否允许显示

#### 4.4 小米推送限制

- **限制说明**：
  - 单个应用每日推送数量有限制（开发环境 1000 条/天）
  - 单个设备每日接收数量有限制
  - 用户关闭通知后无法推送
  - 部分系统版本需要额外权限
